<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		 <meta http-equiv="Cache-Control" content="no-siteapp">
		<title>个人资料</title>
		 <link rel="icon" href="http://m.bxgogo.com/favicon.ico" type="image/x-icon">

	    <link rel="stylesheet" href="public/css/amazeui.css">
		<link rel="stylesheet" href="public/css/new_file.css">
		
		<link rel="stylesheet" href="public/css/reset.css" />
		<link rel="stylesheet" href="public/css/layer-animate.css" />
	
		<link rel="stylesheet" href="css/date.css" />
		<link rel="stylesheet" href="css/moretool.css" />
		<script type="text/javascript" src="public/js/public.js" ></script>
		<script type="text/javascript" src="public/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/method.js"></script>
	<script src="js/jquer_shijian.js" type="text/javascript" ></script>
	
	</head>
	<body>
		<div class="shade" style="display:none"></div>
		<!--头部-->
		<header class="bxg-header">
			<a class="bxg-head-icon bxg-back" href="javascript:history.go(-1);"></a>
			个人资料
			<span class="bxg-head-icon bxg-list"></span>
		</header>
		
		<!--内容-->
		
		<div class="bxg-content">
			
			<!--账户与安全-->
			<div class="bxg-date-list">
				<ul>
					
					<li class="btn1" >
						<a href="#" title="" class="bxg-clear">	
							
						<div class="bxg-head-icon bxg-right-icon"></div>
						<div class="bxg-password-icon bxg-right-icon1" ></div>	
						<div>百信头像</div>

						</a>
					</li>
					
					<li >	
						<a href="#" title="" class="bxg-clear">	
						<!--<div class="bxg-head-icon bxg-right-icon"></div-->
						<div>
								<p class="bxg-head-sex-left">我的账号 </p>
							<p class="bxg-head-sex-right">152****5105 </p>
						</div>
					
						
						</a>
					</li>
					<!--<li class="btn2">-->
						<li class="nickname">
						<a href="#" title="" class="bxg-clear">
							<div class="bxg-head-icon bxg-right-icon"></div>	
							<div>
								<p class="bxg-head-sex-left">我的昵称 </p>
								<p class="bxg-head-sex-right"><span>愤怒的小鸟<i class="r_b"></i></span> </p>
							</div>
					
						
						</a>
					</li>
					
				</ul>
		
				<ul>
					
					<!--<li class="btn3">-->
							
					<li class="xg_sex">		
						<!--<a href="#" style="float:right;margin-left:150px;color:#999;">男</a>-->
						<a href="#" title="" class="bxg-clear">
							
							<div class="bxg-head-icon bxg-right-icon">	</div>
							<div>
					
								
								<p class="bxg-head-sex-left">性别 </p>
								<p class="bxg-head-sex-right"><span>男<i class="r_b"></i></span> </p>
							</div>
						</a>
					</li>
					<li class="btn4" id="date" >	
						
						<a href="#"title="" class="bxg-clear">

							<div class="bxg-head-icon bxg-right-icon"></div>
							<div>
								
								<p class="bxg-head-sex-left">我的生日 </p>
								<p class="bxg-head-sex-right">
									<input type="text"  id="input1" value=""/>
								</p>
									
							</div>
						</a>
					</li>
					<!--弹出层时背景层DIV-->  
					<!--<div id="fade" class="black_overlay">
						 
						
					</div>
					<div id="MyDiv" class="white_content"> 
						<div class="bxg-email-icon"></div>
						<div class="bxg-overstory">
							
							  <div class="bxg-postbox">
									<input type="text"  id="input10" value="请输入邮箱"/>
									
							  </div>
							  <div class="bxg-ensure-abolish">
							  	<p class="bxg-ensure" onClick="return ischeckemail()"><a href="#">确定</a></p>
							  	
							  	<p class="bxg-abolish"><a href="">取消</a></p>
							  </div>
						 </div>
					</div> 
					<li  id="Button1" type="bu" value="" onclick="ShowDiv('MyDiv','fade')" />
						<a href="#" title="" class="bxg-clear">

							<div class="bxg-head-icon bxg-right-icon"> </div>
							<div>
								<p class="bxg-head-sex-left">我的邮箱 </p>
								<p class="bxg-head-sex-right">-->
								<!--<input id="Button1" type="bu" value="" onclick="ShowDiv('MyDiv','fade')" />--> 
									
<!--<input id="str" type="bu" value="" onclick="ShowDiv('MyDiv','fade')" /> -->
									
								<!--</p>
							</div>
						</a>-->
					<!--</li>-->
					
					<li class="xg_email">		
						<!--<a href="#" style="float:right;margin-left:150px;color:#999;">男</a>-->
						<a href="#" title="" class="bxg-clear">
							
							<div class="bxg-head-icon bxg-right-icon">	</div>
							<div>
					
								
								<p class="bxg-head-sex-left">邮箱 </p>
								<p class="bxg-head-sex-right"><span><i class="r_b"></i></span> </p>
							</div>
						</a>
					</li>
					<li>	
						<a href="QuickMark.html" title="" class="bxg-clear">
							<div class="bxg-head-icon bxg-right-icon"></div>
							<div class="bxg-password-icon bxg-right-icon2"></div>
							<div>我的二维码</div>
						</a>
					</li>

				</ul>
			
			</div>
		</div>	
       	
	       	<!--头像修改-->
	       <!--图片上传框-->
		<div class="am-modal am-modal-no-btn up-modal-frame" tabindex="-1" id="up-modal-frame">
			<div class="am-modal-dialog up-frame-parent up-frame-radius">
				<div class="am-modal-hd up-frame-header">
					<label>修改头像</label>
					<a href="javascript:%20void(0)" class="am-close am-close-spin" data-am-modal-close="">×</a>
				</div>
				<div class="am-modal-bd  up-frame-body">
					<div class="am-g am-fl">
						<div class="am-form-group am-form-file">
							<div class="am-fl">
								<button type="button" class="am-btn am-btn-default am-btn-sm">选择要上传的文件</button>
							</div>
							<input class="up-img-file" type="file">
						</div>
					</div>
					<div class="am-g am-fl">
						<div class="up-pre-before up-frame-radius">
							<img alt="" src="" class="up-img-show" id="up-img-show">
						</div>
						<!--<div class="up-pre-after up-frame-radius"></div>-->
					</div>
					<div class="am-g am-fl">
						<div class="up-control-btns">
							<span id="up-btn-left"></span>
							<span id="up-btn-right"></span>
							<!--修改宽高改变向后台传图片的大小 -->
							<span class="up-btn-ok" url="" parameter="{width:'100',height:'100'}">上传</span>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!--加载框-->
		<div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1" id="up-modal-loading">
			<div class="am-modal-dialog">
				<div class="am-modal-hd">正在上传...</div>
				<div class="am-modal-bd">
					<span class="am-icon-spinner am-icon-spin"></span>
				</div>
			</div>
		</div>
		
		<!--警告框-->
		<div class="am-modal am-modal-alert" tabindex="-1" id="up-modal-alert">
			<div class="am-modal-dialog">
				<div class="am-modal-hd">信息</div>
				<div class="am-modal-bd" id="alert_content">
					成功了
				</div>
				<div class="am-modal-footer">
					<span class="am-modal-btn">确定</span>
				</div>
			</div>
		</div>
		<form name="basicInfo">
	       	<!--百信昵称修改-->
	       	<section class="amend amend_nickname" style="display: none;">
	       		
	       		<div><input name="nickname" placeholder="请输入新昵称" value="" onkeyup="value=value.replace(/\s/g,'')" type="text"></div>
	       		<span class="bxg-numberalphabet">昵称有字母、数字和符号组成</span>
	       		<div class="Next" id="next">保存</div>
	       	</section>
	       	<!--性别修改-->
	       	<section class="amend amend_sex" style="display: none;">
	       		
	       		<ul>
	       			
	       			 <input name="sex" value="男" type="hidden">
					<li class="bxg-women">女</li>
	       			<li class="bxg-boy">男</li>
	       			
	       		</ul>
	       		<ul>
	       				<li class="bxg-abrogate"><a href="javascript:history.go(-1)">取消</a></li>
	       		</ul>
	       	
	       		
	       	</section>
	       	<!--邮箱修改-->
	       	<section class="bxg-postbox amend_email" style="display: none;">
	       		<span class="bxg-email-icon"></span>
	       		<div class="bxg-input-email">
	       		<!--	<input name="email" placeholder="请输入邮箱" value="请输入邮箱" type="email">-->
	       			<input name="emailaddress" placeholder="请输入您的Email?" class="email" type="email" required />
	       		</div>
	       		<div class="bxg-affirm" id="next">确认</div>
	       		<div class="abrogate" id="abrogate"><a href="javascript:history.go(-1)">取消</a></div>
	       	</section>
       	</form>
       	
       	
       	<!--提示-->
       	<section class="public-pop" style="z-index: 100; left: 50%; margin-left: -25%; width: 50%; height: 30px; line-height: 30px; font-size: 12px; display: none;">邮箱格式不正确</section>
      


		<script type="text/javascript" src="js/amazeui.js"></script>
		<script type="text/javascript" src="js/cropper.js"></script>
       	<script type="text/javascript">
       		$(function(){
				
				function showHide(obj,arrObj,show,hide){
					obj.bind('click',function(){
						show.show();
						hide.show();
					});
					arrObj.bind('click',function(){
						show.hide();
						hide.hide();
					});
					hide.bind('click',function(){
						show.hide();
						hide.hide();
					});
				}
				//改变头像
				// $('.amend_avatar>ul li').click(function(){
				// 	alert($(this).index());
				// });
				// showHide($('.xg_avater'),$('.amend_avatar>ul li'),$('.amend_avatar'),$('.shade'));
				
				//会员名不可修改
				$('.vip_name').click(function(){
					$('.public-pop').text('百信账户作为登录名不可修改!').show();
					setTimeout(function(){
						$('.public-pop').hide();
					},2000);
				});
				//修改百信昵称
				$('.nickname').click(function(){
					$('.amend_nickname').show();
					$('.shade').show();
				});
				$('.amend_nickname .Next').click(function(){
					var nick = $('.amend_nickname input').val();
					if(nick == ''){
						$('.public-pop').text('请输入新昵称').show();
						setTimeout(function(){
							$('.public-pop').hide();
						},1000);
					}else{

						$('.nickname span').html(nick+"<i class='r_b'></i>");
						$('.amend_nickname').hide();
						$('.shade').hide();
						infoSave();
					}
				});
				$('.shade').click(function(){
					$('.amend_nickname').hide();
					$('.shade').hide();
				});
				//修改性别
				$('.amend_sex>ul li').click(function(){
					$(this).parent().find('input:hidden').val($(this).text());
					$('.xg_sex').find('span').html($(this).text()+"<i class='r_b'></i>");
					infoSave();
				});
				showHide($('.xg_sex'),$('.amend_sex>ul li'),$('.amend_sex'),$('.shade'));
				//修改绑定邮箱
				$('.xg_email').click(function(){
					$('.amend_email').show();
					$('.shade').show();
				});
				function checkEmail(email){
					var reg =  /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
					if(email.match(reg)){
						return true;
					}else{
						return false;
					}
				}
				$('.amend_email .Next').click(function(){
					var email = $('.amend_email input').val();
					if(email == ''){
						$('.public-pop').text('请输入邮箱名称').show();
						setTimeout(function(){
							$('.public-pop').hide();
						},1000);
					}else if(!checkEmail(email)){
						$('.public-pop').text('邮箱格式不正确').show();
						setTimeout(function(){
							$('.public-pop').hide();
						},1000);
					}else{
						$('.xg_email span').html(email+"<i class='r_b'></i>");
						$('.amend_email').hide();
						$('.shade').hide();
						infoSave();
					}
				});
				$('.shade').click(function(){
					$('.amend_email').hide();
					$('.shade').hide();
				});

				$(".avatar").click(function() {
				
					$("#up-modal-frame").modal({});
				});
				$(function() {
				'use strict';
				var $image = $('#up-img-show');
				$image.cropper({
					aspectRatio: '1',
					autoCropArea: 0.8,
					preview: '.up-pre-after',
					responsive: true,
				});
				
				var $inputImage = $('.up-modal-frame .up-img-file');
				var URL = window.URL || window.webkitURL;
				var blobURL;
				
				if(URL) {
					$inputImage.change(function() {
						var files = this.files;
						var file;
						
						if(files && files.length) {
							file = files[0];
							if(/^image\/\w+$/.test(file.type)) {
								blobURL = URL.createObjectURL(file);
								$image.one('built.cropper', function() {
									// Revoke when load complete
									URL.revokeObjectURL(blobURL);
								}).cropper('reset').cropper('replace', blobURL);
								$inputImage.val('');
							} else {
								window.alert('图片格式错误！');
							}
						}
					});
				} else {
					$inputImage.prop('disabled', true).parent().addClass('disabled');
				}
				
				//点击上传按钮
				$('.up-modal-frame .up-btn-ok').on('click', function() {
					var $modal_loading = $('#up-modal-loading');
					var $modal_alert = $('#up-modal-alert');
					var img_src = $image.attr("src");
					if(img_src == "") {
						set_alert_info("请选择图片！");
						$modal_alert.modal();
						return false;
					}
					
					$modal_loading.modal();
					
					var url = $(this).attr("url");
					//parameter
					var parameter = $(this).attr("parameter");
					//console.log(parameter);
					var parame_json = eval('(' + parameter + ')');
					var width = parame_json.width;
					var height = parame_json.height;
					//console.log(parame_json.width);
					//console.log(parame_json.height);
					
					var canvas = $image.cropper('getCroppedCanvas', {
						width: width,
						height: height
					});
					var data = canvas.toDataURL(); //
					//改变默认头像
					$(".avatar").attr("src", data);
					$.ajax({
						dataType: 'json',
						type: "POST",
						data:{
							"image": data.toString()
						}, //data.toString()将画布里的选中区域图片转换为Base64格式向后台传输
						url: "http://www.bxgogo.com/index/user/upload_tou",
						success:function(data, textStatus) {
							$modal_loading.modal('close');
							set_alert_info(data.result);
							$modal_alert.modal();
							if(data.result == "ok"){
								
								$("#up-img-touch img").attr("src", data.file);
								// var img_name = data.file.split('/')[2];
								// alert(data.file);
								//console.log(img_name);
								// $(".up-img-txt a").text(img_name);
								$("#up-modal-frame").modal('close');

							}
						},
						error: function() {
							$modal_loading.modal('close');
							set_alert_info("传输图片失败!");
							$modal_alert.modal();
							//console.log('Upload error');
						}
					});
				});
				
				//左右旋转图片
				$('#up-btn-left').on('click', function() {
					$("#up-img-show").cropper('rotate', 90);
				});
				$('#up-btn-right').on('click', function() {
					$("#up-img-show").cropper('rotate', -90);
				});
			});
			
			function set_alert_info(content) {
				$("#alert_content").html(content);
			}

				 //infoSave();
				 function infoSave() {

		            var param = $('form[name="basicInfo"]').serialize();
		            param = decodeURIComponent(param, true);
		            $.ajax({
		                type: "post",
		                data: {
		                    info: param
		                },
		                url: "http://www.bxgogo.com/index/user/aboutMe",
		                success: function(data) {
		                   var dataJson = eval(data);
			       			if(dataJson.flag){
				       			$(".public-pop").html(dataJson.msg).show();
						       		setTimeout(function(){
						       		$(".public-pop").hide();
						       	},2000);
			       			}else{
			       				$(".public-pop").html(dataJson.msg).show();
					       		setTimeout(function(){
					       			$(".public-pop").hide();
					       		},2000);
			       			}
		                }
		            });
		        }	
       		});
       	</script>

			<script type="text/javascript">
   //type值用来切换显示效果slideFromTop、slideFromBottom、showSweetAlert、none、layerFadeIn、layer-fadeInUpBig、layer-rollIn、layer-shake、layer-spread、layer-fadeIn
    $(".btn1").on("click",function(){
        var obj={
            type:"slideFromTop",
         
            close:"false",
            content:"<div class='bxg-phopo'><p style='border-bottom:1px solid #ddd;'>拍张</p><p>选择相册</p>",
          
           btn:["取消"]
        };
        method.msg_layer(obj);
    });
    
    $(".btn2").on("click",function(){
       var obj={
           type:"slideFromBottom",
           //有title属性的话，则有标题，标题内容为title值，无title属性则无标题
           title:"<div class='bxg-name-input'><input type='text' name='lastname' value='请输入' class='bxg-import'></div>",
           content:"<div class='bxg-name-num'>昵称有数字、字母和符号组成",
         
           btn:["保存"]
       };
       method.msg_layer(obj);
   });
    
     $(".btn3").on("click",function(){
        var obj={
            type:"slideFromTop",
           
            close:"false",
            content:"<div class='bxg-phopo'><p style='border-bottom:1px solid #ddd;'><label><input name='Fruit' type='radio' value='' />男</label></p><p><label><input name='Fruit' type='radio' value='' />女</label></p>",
        
           btn:["确定"]
        };
        method.msg_layer(obj);
    });
    
    

    
   
		$("#input1").shijian({
			y:-20//当前年份-20
		})
		$("#input2").shijian({
			showNowTime:false,
			Year:false,//是否显示年//
            Month:false,//是否显示月//
            Day:false,//是否显示日//
            h:"00",
            m:"01",
			alwaysShow:true,
			timeElm:$(".time-box"),//sjObj表示当前对象
		})
		
		
 
			//弹出隐藏层  
			function ShowDiv(show_div,bg_div){  
			 document.getElementById(show_div).style.display='block';  
			 document.getElementById(bg_div).style.display='block' ;  
			 var bgdiv = document.getElementById(bg_div);  
			 bgdiv.style.width = document.body.scrollWidth;   
		
			 $("#"+bg_div).height($(document).height());  
			};  
			
			function CloseDiv(show_div,bg_div)  
			{  
			 document.getElementById(show_div).style.display='none';  
			 document.getElementById(bg_div).style.display='none';  
			}; 
			
			
			
	//邮箱格式
			
//			function ischeckemail(){
//			
//			var email = document.getElementById("input10").value;
//			alert(email);
//			  if (email != "") {
//			
//			     var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
//			
//			     isok= reg.test(email );
//			
//			       if (!isok) {
//			
//			            alert("邮箱格式不正确，请重新输入！");
//			
//			            document.getElementById("input10").focus();
//			
//			            return false;
//			
//			        }
//			
//			    };
//			
//			}
				
				

		</script>	

	</body>
</html>